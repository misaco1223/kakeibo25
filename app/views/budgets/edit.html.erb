<div class="navbar max-w-[32rem] w-full">
  <a class="btn btn-ghost text-xl gray-900">予算を編集</a>
</div>

<div class="container bg-white shadow-md", style="padding:24px; border-radius:8px; max-width:400px;">
  <%= form_with model: @budget, local: true, class: "space-y-4" do |form| %>
    <%= form.hidden_field :money_file_id, value: @money_file.id %>

    <!-- 家計簿ファイルを表示する -->
    <div>
      <p><i class="fa-regular fa-folder"></i> <%= @money_file.title %>ファイル</p>
      <%= form.hidden_field :money_file_id, value: params[:money_file_id] %>
    </div>

    <br>
    <!--予算の設定月-->
    <div>
      <%= form.label :year_month, "何月の予算にしますか(必須) :", class: "block text-gray-700" %>
      <%= form.select :year_month, options_for_select(
        (Date.today.year-5..Date.today.year+5).to_a.map { |year| ["#{year}年", year] }, 
        selected: session[:year_month]&.split("-")&.first
      ), 
      { prompt: "選択してください" }, 
      style: "margin: 4px; padding: 10px; border-radius: 8px; border: 1px solid #ccc; width: 45%;" 
      %>
      <%= form.select :month, options_for_select(
        Date::MONTHNAMES.compact.each_with_index.map { |month, i| ["#{i+1}月", i+1] }, 
        selected: session[:year_month]&.split("-")&.last
      ), 
      { prompt: "月を選択" }, 
      style: "margin: 4px; padding: 10px; border-radius: 8px; border: 1px solid #ccc; width: 45%;" 
      %>
    </div>

    <!-- カテゴリー入力 -->
    <div>
      <%= form.label :category_id, "カテゴリー(必須) :", class: "block text-gray-700" %>
      <%= form.collection_select :category_id, @categories, :id, :name, 
      { prompt: "カテゴリーを選択してください" },
      {  style: "margin: 4px; padding: 10px; border-radius: 8px; border: 1px solid #ccc;"  } %>
      <a class="btn text-sm btn-ghost" href="#", id="new-category-link">新しいカテゴリーを作成する<i class="fa-solid fa-plus"></i></a>
    </div>

    <br>
    <!-- 画像入力 -->
    <div>
      <%= form.label :budget_image, "画像:", class: "block text-gray-700" %>
        <% if @budget.budget_image.present? %>
          <!-- 現在登録されている画像を表示 -->
          <%= image_tag @budget.budget_image_url, class: "card-img-top", width: "150", height: "100" %>
          <!-- 画像削除用のチェックボックス -->
          <%= form.label :remove_budget_image, "現在の画像を削除する", class: "block text-red-500 mt-2" %>
          <%= form.check_box :remove_budget_image, class: "form-checkbox h-5 w-5 text-red-600" %>
        <% end %>
      <%= form.file_field :money_file_image, style: "margin: 4px; padding: 10px; border-radius: 8px; border: 1px solid #ccc; max-width:300px;", accept: 'image/*' %>
      <%= form.hidden_field :budget_image_cache %>
   </div>

    <br>
    <!-- 説明入力 -->
    <div>
      <%= form.label :description, "詳細 :", class: "block font-medium text-gray-700" %>
      <%= form.text_area :description, rows: 3,  style: "margin: 4px; padding: 10px; border-radius: 8px; border: 1px solid #ccc;" %>
    </div>

    <br>
    <!-- 金額入力 -->
    <div>
      <%= form.label :amount, "予算金額(必須) :", class: "block font-medium text-gray-700" %>
      <%= form.number_field :amount, min: 0, step: 100, style: "margin: 4px; padding: 10px; border-radius: 8px; border: 1px solid #ccc;"  %>
    </div>

    <br>
    <!-- 提出ボタン -->
    <div>
      <%= form.submit "予算を作成", class: "btn", style:"background-color:#FFCC66;" %>
      <%= link_to "キャンセル", money_file_path(@money_file), class: "btn" %>
    </div>
  <% end %>
</div>

<!-- 新しいカテゴリー作成フォーム -->
<div id="new-category-form" style="display:none; background-color: white; border: 1px solid #ccc; padding: 20px; border-radius: 8px; width: 300px; margin: 20px auto;">
  <%= form_with model: Category.new, url: categories_path, local: true, class: "space-y-4" do |category_form| %>
    <%= category_form.hidden_field :user_id, value: current_user.id %>
    <div>
      <%= category_form.label :name, "カテゴリー名", class: "block text-gray-700" %>
      <%= category_form.text_field :name, class: "w-full", style: "border: 1px solid #ccc;" %>
    </div>
    <br>
    <div class="text-center mt-4">
      <%= category_form.submit "カテゴリーを作成", class: "btn", style:"background-color:#FFCC66;" %>
      <%= link_to "キャンセル", edit_budget_path(money_file_id: @money_file.id), class:"btn" %>
    </div>
  <% end %>
</div>

<script>
  document.getElementById('new-category-link').addEventListener('click', function(e) {
    e.preventDefault();
    var form = document.getElementById('new-category-form');
     // ボタンの親要素を取得し、その下にフォームを移動
    const buttonContainer = document.getElementById('new-category-link');
    buttonContainer.after(form);
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
  });
</script>